{% load math_filters %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Order Confirmation</title>
</head>
<body style="font-family: Arial, sans-serif; background-color: #f9f9f9; margin: 0; padding: 20px;">

    <table width="100%" cellpadding="0" cellspacing="0" style="max-width: 600px; margin: auto; background: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <!-- HEADER WITH LOGO -->
        <tr>
            <td style="background-color: #222; text-align: center; padding: 20px;">
                <img src="https://cdn.shopify.com/s/files/1/0682/5223/7902/files/63bae4d9-5e93-4caa-9f06-44ebbef80ce2.jpg?v=1755083550"
                     alt="Triple A Logo"
                     width="120"
                     style="display: block; margin: auto; max-width: 100px;">
                <p style="margin: 10px 0 0; font-size: 14px; color: #fff;">Order Confirmation</p>
            </td>
        </tr>

        <!-- BODY -->
        <tr>
            <td style="padding: 20px;">
                <h3 style="margin-top: 0; color: #333;">Thank you for your order!</h3>
                <p style="margin: 5px 0;">Order ID: <strong>#{{ order.order_id }}</strong></p>
                <p style="margin: 5px 0;">Total: <strong>₦{{ order.total_amount }}</strong></p>

                {% if order.shipping_method and "pick" in order.shipping_method|lower %}
                    <p style="margin: 5px 0; color: #28a745;"><strong>Pickup at Store:</strong> Available once payment is confirmed.</p>
                    <p style="margin: 5px 0;"><strong>Store Address:</strong> 2 Oba Akran, Ikeja, Lagos.</p>
                    <p style="margin: 5px 0;"><strong>Phone:</strong> +2348023975782</p>
                {% else %}
                    <p style="margin: 5px 0; color: #28a745;"><strong>Estimated Delivery:</strong> 1–3 business days after payment confirmation.</p>
                {% endif %}

                <!-- ORDER ITEMS -->
                <h4 style="margin-top: 20px; color: #444;">Order Items:</h4>
                <table width="100%" cellpadding="8" cellspacing="0" style="border-collapse: collapse; border: 1px solid #ddd;">
                    <thead>
                        <tr style="background: #f1f1f1;">
                            <th align="left" style="border: 1px solid #ddd;">Product</th>
                            <th align="center" style="border: 1px solid #ddd;">Qty</th>
                            <th align="right" style="border: 1px solid #ddd;">Price</th>
                            <th align="right" style="border: 1px solid #ddd;">Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in cart_items %}
                        <tr>
                            <td style="border: 1px solid #ddd;">{{ item.product.name }}</td>
                            <td align="center" style="border: 1px solid #ddd;">{{ item.quantity }}</td>
                            <td align="right" style="border: 1px solid #ddd;">₦{{ item.price }}</td>
                            <td align="right" style="border: 1px solid #ddd;">₦{{ item.quantity|mul:item.price }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <p style="margin-top: 20px; font-size: 16px;">
                    <strong>Order Total:</strong> ₦{{ order.total_amount }}
                </p>

                <!-- SHIPPING DETAILS -->
                <h4 style="margin-top: 25px; color: #444;">Shipping Information:</h4>
                {% if order.shipping_method and "pick" in order.shipping_method|lower %}
                    <p style="margin: 5px 0;"><strong>Pickup:</strong> At our store location</p>
                    <p style="margin: 5px 0;"><strong>Address:</strong> 2 Oba Akran, Ikeja, Lagos</p>
                    <p style="margin: 5px 0;"><strong>Phone:</strong> +2348023975782</p>
                {% else %}
                    <p style="margin: 5px 0;"><strong>Name:</strong> {{ order.first_name }} {{ order.last_name }}</p>
                    <p style="margin: 5px 0;"><strong>Phone:</strong> {{ order.phone }}</p>
                    <p style="margin: 5px 0;"><strong>Address:</strong> {{ order.address }}, {{ order.city }}, {{ order.state }}, {{ order.country }} - {{ order.postal_code }}</p>
                {% endif %}

                <!-- CTA BUTTONS -->
                <div style="margin-top: 25px; text-align: center;">
                    <a href="{{ view_order_url }}"
                       style="background-color: #28a745; color: white; padding: 12px 20px; text-decoration: none; border-radius: 5px; display: inline-block; margin-right: 10px;">
                        View Order
                    </a>
                    <a href="{{ cancel_order_url }}"
                       style="background-color: #dc3545; color: white; padding: 12px 20px; text-decoration: none; border-radius: 5px; display: inline-block;">
                        Cancel Order
                    </a>
                </div>

                <p style="margin-top: 30px; font-size: 14px; color: #666;">
                    Thanks for shopping with <strong>Triple A</strong>.
                </p>
            </td>
        </tr>

        <!-- FOOTER -->
        <tr>
            <td style="background: #f1f1f1; text-align: center; padding: 15px; font-size: 12px; color: #777;">
                &copy; {{ now|date:"Y" }} Triple A. All rights reserved.
            </td>
        </tr>
    </table>

</body>
</html>
