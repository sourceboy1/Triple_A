(function(a){var e=function(o){return o.is(".processing")||o.parents(".processing").length};var c=function(o){if(!a.fn.block||!o){return}if(!e(o)){o.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}};var s=function(o){if(!a.fn.unblock||!o){return}o.removeClass("processing").unblock()};var n=function(o,e,t){var r;try{r=new CustomEvent(e,{bubbles:true,cancelable:true,detail:t||null})}catch(o){r=document.createEvent(e);r.initCustomEvent(e,true,true,t||null)}o.dispatchEvent(r)};var o=function(){this.selectors={text:".wcboost-products-compare-button__text",icon:".wcboost-products-compare-button__icon"};this.addToCompare=this.addToCompare.bind(this);this.removeFromCompare=this.removeFromCompare.bind(this);a(document.body).on("click",".wcboost-products-compare-button--ajax",{compareButtonHandler:this},this.onButtonClick)};o.prototype.onButtonClick=function(o){var e=o.data.compareButtonHandler;var t=a(o.currentTarget);if(t.hasClass("loading")){o.preventDefault();return}if(!t.hasClass("added")){o.preventDefault();e.addToCompare(t)}else if("remove"===wcboost_products_compare_params.exists_item_behavior){o.preventDefault();e.removeFromCompare(t)}};o.prototype.addToCompare=function(t){var r=this;var o={product_id:t.data("product_id")};a.post({url:woocommerce_params.wc_ajax_url.toString().replace("%%endpoint%%","add_to_compare"),data:o,dataType:"json",beforeSend:function(){t.removeClass("added").addClass("loading");t.find(r.selectors.icon).html(wcboost_products_compare_params.icon_loading)},success:function(o){if(!o.success){return}var e=o.data.fragments;t.addClass("added");switch(wcboost_products_compare_params.exists_item_behavior){case"view":t.attr("href",wcboost_products_compare_params.page_url);t.find(r.selectors.text).text(wcboost_products_compare_params.i18n_button_view);t.find(r.selectors.icon).html(wcboost_products_compare_params.icon_checked);break;case"remove":t.attr("href",o.data.remove_url);t.find(r.selectors.text).text(wcboost_products_compare_params.i18n_button_remove);t.find(r.selectors.icon).html(wcboost_products_compare_params.icon_checked);break;case"popup":t.attr("href",wcboost_products_compare_params.page_url);t.find(r.selectors.text).text(wcboost_products_compare_params.i18n_button_view);t.find(r.selectors.icon).html(wcboost_products_compare_params.icon_checked);t.addClass("wcboost-products-compare-button--popup");break;case"hide":t.hide();break}a(document.body).trigger("wcboost_compare_item_added",[o.data]).trigger("added_to_compare",[t,e,o.data.count]);if("redirect"===wcboost_products_compare_params.added_behavior&&wcboost_products_compare_params.page_url){window.location=wcboost_products_compare_params.page_url}},complete:function(){t.removeClass("loading")}})};o.prototype.removeFromCompare=function(t){var r=this;var o=new URLSearchParams(t[0].search);var e={item_key:o.get("remove_compare_item"),_wpnonce:o.get("_wpnonce")};if(!e.item_key){return}a.post({url:woocommerce_params.wc_ajax_url.toString().replace("%%endpoint%%","remove_compare_item"),data:e,dataType:"json",beforeSend:function(){t.removeClass("added").addClass("loading");t.find(r.selectors.icon).html(wcboost_products_compare_params.icon_loading)},success:function(o){if(!o.success){return}var e=o.data.fragments;t.attr("href",o.data.add_url);t.find(r.selectors.text).text(wcboost_products_compare_params.i18n_button_add);t.find(r.selectors.icon).html(wcboost_products_compare_params.icon_normal);a(document.body).trigger("wcboost_compare_item_removed",[o.data]).trigger("removed_from_compare",[t,e])},complete:function(){t.removeClass("loading")}})};var r=function(o){var e=this;e.$container=a(o);e.$container.off(".wcboost-products-compare");e.sendAjaxUpdateList=e.sendAjaxUpdateList.bind(e);e.updateList=e.updateList.bind(e);e.$container.on("click.wcboost-products-compare","a.wcboost-products-compare-remove",{productsCompare:e},e.onRemoveItem);e.$container.on("click.wcboost-products-compare",".wcboost-products-compare-clear",{productsCompare:e},e.onClearList)};r.prototype.onRemoveItem=function(o){o.preventDefault();o.data.productsCompare.sendAjaxUpdateList(o.currentTarget.href)};r.prototype.onClearList=function(o){o.preventDefault();o.data.productsCompare.sendAjaxUpdateList(o.currentTarget.href)};r.prototype.sendAjaxUpdateList=function(o){var t=this;a.ajax({url:o,type:"POST",data:{_wp_http_referer:wcboost_products_compare_params.page_url,time:(new Date).getTime()},dataType:"html",beforeSend:function(){c(t.$container)},success:function(o){t.updateList(o);var e=a('[role="alert"]');if(e.length&&e.is(":visible")){a("html, body").animate({scrollTop:e.offset().top-100},1e3)}},complete:function(){if(t.$container){s(t.$container)}}})};r.prototype.updateList=function(o){var e=this,t=a.parseHTML(o),r=a(".wcboost-products-compare",t),p=a(".wcboost-products-compare--empty",r).length?true:false,c={};a(".woocommerce-error, .woocommerce-message, .woocommerce-info, .woocommerce-info, .is-success, .is-error, .is-info").remove();e.$container.html(r.html());r.remove();c=a(".woocommerce-error, .woocommerce-message, .woocommerce-info, .is-success, .is-error, .is-info",t);if(p){n(document.body,"products_compare_list_emptied")}if(c.length>0){e.$container.prepend(c)}n(document.body,"products_compare_list_updated")};var t=function(){var o=this;o.opened=false;o.xhr=null;o.$popup=a("#wcboost-products-compare-popup");o.$content=a(".wcboost-products-compare-popup__content",o.$popup);o.togglePopup=o.togglePopup.bind(o);a(document.body).on("click",".wcboost-products-compare-popup-trigger",{comparePopup:o},o.triggerOpenPopup).on("click",".wcboost-products-compare-button--popup.added",{comparePopup:o},o.triggerOpenPopup).on("products_compare_popup_open",{comparePopup:o},o.openPopup).on("products_compare_popup_loaded",{comparePopup:o},o.handleCompareActions).on("products_compare_list_updated",{comparePopup:o},o.refreshFragments).on("products_compare_list_emptied",{comparePopup:o},o.emptyPopup);if("popup"===wcboost_products_compare_params.added_behavior){a(document.body).on("added_to_compare",{comparePopup:o},o.triggerOpenPopupOnAdded)}o.$popup.on("click",".wcboost-products-compare-popup__backdrop, .wcboost-products-compare-popup__close",{comparePopup:o},o.closePoup)};t.prototype.triggerOpenPopup=function(o){o.preventDefault();n(document.body,"products_compare_popup_open")};t.prototype.triggerOpenPopupOnAdded=function(o,e,t,r){if(r>1){n(document.body,"products_compare_popup_open")}};t.prototype.openPopup=function(o){var t=o.data.comparePopup;if(!wcboost_products_compare_params.page_url){return}if(t.xhr){t.xhr.abort()}t.xhr=a.ajax({url:wcboost_products_compare_params.page_url,data:{popup:1},type:"GET",dataType:"html",beforeSend:function(){c(t.$content);t.$popup.addClass("wcboost-products-compare-popup--loading");t.togglePopup(true);n(document.body,"products_compare_popup_loading")},success:function(o){var e=a(".wcboost-products-compare.woocommerce",o);t.$content.html(e);n(document.body,"products_compare_popup_loaded")},complete:function(){s(t.$content);t.$popup.removeClass("wcboost-products-compare-popup--loading")}})};t.prototype.handleCompareActions=function(o){var e=o.data.comparePopup,t=e.$content.find(".wcboost-products-compare");if(t.length){new r(t)}};t.prototype.closePoup=function(o){o.preventDefault();var e=o.data.comparePopup;e.togglePopup(false)};t.prototype.refreshFragments=function(o){var e=o.data.comparePopup;if(!e.opened){return}a(document.body).trigger("products_compare_fragments_refresh",[true])};t.prototype.emptyPopup=function(o){var e=o.data.comparePopup;e.$content.html("");e.togglePopup(false)};t.prototype.togglePopup=function(o){var e=this;if(o){e.opened=true;e.$popup.stop(true,true).fadeIn(150,function(){e.$popup.addClass("wcboost-products-compare-popup--open")});n(document.body,"products_compare_popup_opened")}else{e.$popup.stop(true,true).fadeOut(150,function(){e.$popup.removeClass("wcboost-products-compare-popup--open");e.opened=false});n(document.body,"products_compare_popup_closed")}};var p=function(){var o=this;o.widgetClass=".wcboost-products-compare-widget-content";o.checkEmptyWidgetVisibility=o.checkEmptyWidgetVisibility.bind(o);o.hideWidgets=o.hideWidgets.bind(o);o.showWidgets=o.showWidgets.bind(o);a(document.body).on("click",o.widgetClass+" a.remove",{compareWidget:o},o.removeItem).on("click",o.widgetClass+" .wcboost-products-compare-clear",{compareWidget:o},o.clearList).on("click",o.widgetClass+" .wcboost-products-compare-open",{compareWidget:o},o.openCompare);o.checkEmptyWidgetVisibility()};p.prototype.checkEmptyWidgetVisibility=function(){var o=this;var e=a(o.widgetClass);if(!e.length){return}e.each(function(){var o=a(this);if(!o.closest(".wcboost-products-compare-widget__hidden-content").length){return}if(o.find(".wcboost-products-compare-widget__products").length){return}o.closest(".wcboost-products-compare-widget").hide()});a(document.body).on("products_compare_list_emptied",{compareWidget:o,compareListEmpty:true},o.toggleVisibility).on("added_to_compare",{compareWidget:o,compareListEmpty:false},o.toggleVisibility)};p.prototype.toggleVisibility=function(o){var e=o.data.compareWidget;var t=o.data.compareListEmpty;if(t){e.hideWidgets()}else{e.showWidgets()}};p.prototype.hideWidgets=function(){var o=this;var e=a(o.widgetClass);e.each(function(){var o=a(this);if(!o.closest(".wcboost-products-compare-widget__hidden-content").length){return}o.closest(".wcboost-products-compare-widget").hide()})};p.prototype.showWidgets=function(){var o=this;var e=a(o.widgetClass);e.each(function(){var o=a(this);if(!o.closest(".wcboost-products-compare-widget__hidden-content").length){return}o.closest(".wcboost-products-compare-widget").show()})};p.prototype.removeItem=function(o){var e=o.data.compareWidget;var t=new URLSearchParams(o.currentTarget.search);var r={item_key:t.get("remove_compare_item"),_wpnonce:t.get("_wpnonce")};if(!r.item_key){return}var p=a(e.widgetClass);o.preventDefault();a.post({url:woocommerce_params.wc_ajax_url.toString().replace("%%endpoint%%","remove_compare_item"),data:r,dataType:"json",beforeSend:function(){c(p)},success:function(o){if(!o.success){return}var e=o.data.fragments;a(document.body).trigger("removed_from_compare",[null,e]);a(document.body).trigger("products_compare_fragments_refresh",[true])},complete:function(){s(p)}})};p.prototype.clearList=function(o){o.preventDefault();var e=o.data.compareWidget;var t=a(e.widgetClass);a.ajax({url:o.currentTarget.href,type:"GET",dataType:"html",beforeSend:function(){c(t)},success:function(){n(document.body,"products_compare_list_emptied");a(document.body).trigger("products_compare_fragments_refresh",[true])},complete:function(){s(t)}})};p.prototype.openCompare=function(o){var e=a(o.currentTarget).closest("[data-compare]");if(e.length&&"popup"===e.data("compare")){o.preventDefault();n(document.body,"products_compare_popup_open")}};var d=function(o){var e=this;e.$bar=a(o);e.$bar.on("click",".wcboost-products-compare-bar__toggle-button",{compareBar:e},e.toggleCompareBar)};d.prototype.toggleCompareBar=function(o){o.preventDefault();var e=o.data.compareBar;e.$bar.toggleClass("wcboost-products-compare-bar--open")};a(function(){new o;new t;new p;new d("#wcboost-products-compare-bar");a(".wcboost-products-compare").each(function(){new r(this)})})})(jQuery);